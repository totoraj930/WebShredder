"use strict";function asyncGeneratorStep(a,b,c,d,e,f,g){try{var h=a[f](g),i=h.value}catch(a){return void c(a)}h.done?b(i):Promise.resolve(i).then(d,e)}function _asyncToGenerator(a){return function(){var b=this,c=arguments;return new Promise(function(d,e){function f(a){asyncGeneratorStep(h,d,e,f,g,"next",a)}function g(a){asyncGeneratorStep(h,d,e,f,g,"throw",a)}var h=a.apply(b,c);f(void 0)})}}function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function _defineProperties(a,b){for(var c,d=0;d<b.length;d++)c=b[d],c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(a,c.key,c)}function _createClass(a,b,c){return b&&_defineProperties(a.prototype,b),c&&_defineProperties(a,c),a}/* https://ja.wikipedia.org/wiki/Xorshift */var backImage,Xorshift=/*#__PURE__*/function(){function a(){_classCallCheck(this,a),this.reset()}return _createClass(a,[{key:"reset",value:function a(){this._x=123456789,this._y=362436069,this._z=521288629,this._w=88675123}},{key:"random",value:function b(){var a=this._x^this._x<<11;return this._x=this._y,this._y=this._z,this._z=this._w,(this._w=this._w^this._w>>19^(a^a>>8))%1e6/1e6}},{key:"seed",set:function b(a){return this._w=a,a}}]),a}(),xors=new Xorshift,$canvas=null,ctx=null,origImageData=null,sImageW=400,sImageH=600,$file=null,$splitNum=null,$splitNumRange=null,$duration=null,$durationRange=null,splitNum=15,duration=1e4,t=0,startTime=Date.now(),isPlay=!1;document.addEventListener("DOMContentLoaded",start);function shredAnimate(){isPlay&&(t=(Date.now()-startTime)/duration,1<t?(t=1,updateShredder(),shredFinished()):(updateShredder(),requestAnimationFrame(shredAnimate)))}function updateShredder(){drawShreddedImage(ctx,origImageData,splitNum,123456789,t),$canvas.style.transform="translateY(".concat(100*t,"%)")}function shredFinished(){isPlay=!1,t=0,updateToggleButton()}function stopShredder(){isPlay=!1,t=0,updateShredder(),updateToggleButton()}function pauseShredder(){isPlay=!1,updateToggleButton()}function playShredder(){isPlay=!0,startTime=Date.now()-duration*t,updateToggleButton(),shredAnimate()}function updateToggleButton(){for(var a,b=isPlay?"Pause":"play",c=document.querySelectorAll(".js_action"),d=0;d<c.length;d++)a=c[d],"toggle"==a.getAttribute("data-action")&&(a.innerHTML=b)}function setSplitNum(a){!isFinite(a)||2>a||100<a||(splitNum=a-0,updateOptionView())}function setDuration(a){!isFinite(a)||1>a||20<a||(duration=1e3*a,updateOptionView())}function updateOptionView(){$splitNum.value=splitNum,$splitNumRange.value=splitNum,$duration.value=duration/1e3,$durationRange=duration/1e3}function setOptionViewListener(a,b){a.forEach(function(a){a.addEventListener("input",b),a.addEventListener("change",b)})}function start(){initShredder(),$file=document.querySelector("#image_file"),$file.addEventListener("change",function(a){var b=a.target.files[0],c=new FileReader;c.addEventListener("load",/*#__PURE__*/function(){var a=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function a(b){return regeneratorRuntime.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.t0=generateImageDataForShredder,a.t1=ctx,a.next=4,loadImage(b.target.result);case 4:a.t2=a.sent,origImageData=(0,a.t0)(a.t1,a.t2);case 6:case"end":return a.stop();}},a,this)}));return function(){return a.apply(this,arguments)}}()),c.readAsDataURL(b)}),$splitNum=document.querySelector("#split_num"),$splitNumRange=document.querySelector("#split_num_range"),$duration=document.querySelector("#duration"),$durationRange=document.querySelector("#duration_range"),setOptionViewListener([$splitNum,$splitNumRange],function(a){setSplitNum(a.target.value)}),setOptionViewListener([$duration,$durationRange],function(a){setDuration(a.target.value)}),updateOptionView();for(var a,b=document.querySelectorAll(".js_action"),c=0;c<b.length;c++){if(a=b[c],!a.hasAttribute("data-action"))return;var d=a.getAttribute("data-action");"toggle"==d?a.addEventListener("click",function(a){a.preventDefault(),isPlay?pauseShredder():playShredder()}):"stop"==d&&a.addEventListener("click",stopShredder)}}function initShredder(){return _initShredder.apply(this,arguments)}function _initShredder(){return _initShredder=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function a(){return regeneratorRuntime.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return $canvas=document.querySelector(".shredded"),$canvas.width=sImageW,$canvas.height=sImageH,ctx=$canvas.getContext("2d"),a.next=6,loadImage("./img/back.jpg");case 6:backImage=a.sent,origImageData=generateImageDataForShredder(ctx);case 8:case"end":return a.stop();}},a,this)})),_initShredder.apply(this,arguments)}function loadImage(a){return new Promise(function(b,c){var d=new Image;d.src=a,d.addEventListener("load",function(){return b(d)}),d.addEventListener("error",function(){return c("Error")})})}function generateImageDataForShredder(a,b,c){var d=Math.round;if(a.clearRect(0,0,a.canvas.width,a.canvas.height),a.drawImage(backImage,0,0),b)if(c){var e=getMagRatio(b.width,b.height,a.canvas.width,a.canvas.height),f=d(b.width*e),g=d(b.height*e),h=(a.canvas.width-f)/2,i=(a.canvas.height-g)/2;a.drawImage(b,h,i,f,g)}else a.drawImage(b,0,0,a.canvas.width,a.canvas.height);return a.getImageData(0,0,$canvas.width,$canvas.height)}function getMagRatio(a,b,c,d){return Math.min(c/a,d/b)}function drawShreddedImage(a,b,c,d,e){var f=b.width,g=b.height;a.clearRect(0,0,f,g),xors.reset(),xors.seed=d,a.putImageData(b,0,0,0,0,f,g*(1-e)+15*e);for(var h=0;h<c;h++){var i=15*xors.random()*e,j=(f-1*(c-1))/c,k=j*h+1*h,l=g*(1-e)+15*e;a.putImageData(b,0,0-i,k,l,j,g-l)}}

//# sourceMappingURL=main.min.js.map